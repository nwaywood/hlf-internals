


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This website contains the description of the internal architecture of Hyperledger Fabric.">
      
      
      
        <meta name="author" content="Christian Vecchiola">
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1, mkdocs-material-5.1.0">
    
    
      
        <title>Chaincode Execution Patterns - Hyperledger Fabric Internals Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.89dc9fe3.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#chaincode-execution-patterns" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="Hyperledger Fabric Internals Documentation" class="md-header-nav__button md-logo" aria-label="Hyperledger Fabric Internals Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,6H21V8H3V6M3,11H21V13H3V11M3,16H21V18H3V16Z" /></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            Hyperledger Fabric Internals Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Chaincode Execution Patterns
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5,3A6.5,6.5 0 0,1 16,9.5C16,11.11 15.41,12.59 14.44,13.73L14.71,14H15.5L20.5,19L19,20.5L14,15.5V14.71L13.73,14.44C12.59,15.41 11.11,16 9.5,16A6.5,6.5 0 0,1 3,9.5A6.5,6.5 0 0,1 9.5,3M9.5,5C7,5 5,7 5,9.5C5,12 7,14 9.5,14C12,14 14,12 14,9.5C14,7 12,5 9.5,5Z" /></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19,6.41L17.59,5L12,10.59L6.41,5L5,6.41L10.59,12L5,17.59L6.41,19L12,13.41L17.59,19L19,17.59L13.41,12L19,6.41Z" /></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/IBM/hlf-internals/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    IBM/hlf-internals
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Hyperledger Fabric Internals Documentation" class="md-nav__button md-logo" aria-label="Hyperledger Fabric Internals Documentation">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12,8A3,3 0 0,0 15,5A3,3 0 0,0 12,2A3,3 0 0,0 9,5A3,3 0 0,0 12,8M12,11.54C9.64,9.35 6.5,8 3,8V19C6.5,19 9.64,20.35 12,22.54C14.36,20.35 17.5,19 21,19V8C17.5,8 14.36,9.35 12,11.54Z" /></svg>

    </a>
    Hyperledger Fabric Internals Documentation
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/IBM/hlf-internals/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    IBM/hlf-internals
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../license/" title="License" class="md-nav__link">
      License
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Chaincode Management Overview
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Chaincode Management Overview" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Chaincode Management Overview
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/chaincode-execution-model/" title="Chaincode Execution Model" class="md-nav__link">
      Chaincode Execution Model
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/peer-operating-modes/" title="Peer Operating Modes" class="md-nav__link">
      Peer Operating Modes
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../overview/secure-networking/" title="Secure Networking" class="md-nav__link">
      Secure Networking
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Interaction Protocol
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Interaction Protocol" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Interaction Protocol
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../protocol/architecture-components/" title="Key Components" class="md-nav__link">
      Key Components
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../protocol/interaction-lifecycle/" title="Interaction Lifecycle" class="md-nav__link">
      Interaction Lifecycle
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../protocol/messages/" title="Messages Exchanged" class="md-nav__link">
      Messages Exchanged
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Shim Architecture
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Shim Architecture" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Shim Architecture
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-2" type="checkbox" id="nav-5-2">
    
    <label class="md-nav__link" for="nav-5-2">
      Components
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Components" data-md-level="2">
      <label class="md-nav__title" for="nav-5-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Components
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../components/shim/" title="Shim" class="md-nav__link">
      Shim
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/handler/" title="Handler" class="md-nav__link">
      Handler
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/chaincode-stub-interface/" title="ChaincodeStubInterface" class="md-nav__link">
      ChaincodeStubInterface
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/chaincode-stub/" title="ChaincodeStub" class="md-nav__link">
      ChaincodeStub
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../components/other-components/" title="Other Components" class="md-nav__link">
      Other Components
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5-3" type="checkbox" id="nav-5-3">
    
    <label class="md-nav__link" for="nav-5-3">
      Interaction Flow
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59,16.58L13.17,12L8.59,7.41L10,6L16,12L10,18L8.59,16.58Z" /></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Interaction Flow" data-md-level="2">
      <label class="md-nav__title" for="nav-5-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
        </span>
        Interaction Flow
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../interaction-flow/overview/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../interaction-flow/transaction-processing/" title="Aysnchronous Transaction Processing" class="md-nav__link">
      Aysnchronous Transaction Processing
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../interaction-flow/talk-backs/" title="Managing Talk-backs with the Peer" class="md-nav__link">
      Managing Talk-backs with the Peer
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../interaction-flow/range-queries/" title="Range Queries and Iterators" class="md-nav__link">
      Range Queries and Iterators
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../interaction-flow/chaincode-events/" title="Chaincode Events" class="md-nav__link">
      Chaincode Events
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Chaincode Execution Patterns
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3,9H17V7H3V9M3,13H17V11H3V13M3,17H17V15H3V17M19,17H21V15H19V17M19,7V9H21V7H19M19,13H21V11H19V13Z" /></svg>
        </span>
      </label>
    
    <a href="./" title="Chaincode Execution Patterns" class="md-nav__link md-nav__link--active">
      Chaincode Execution Patterns
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chaincode-as-server-setup" class="md-nav__link">
    Chaincode as Server Setup
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../security/" title="Securing the Chaincode Process" class="md-nav__link">
      Securing the Chaincode Process
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../peer-architecture/" title="Peer Architecture" class="md-nav__link">
      Peer Architecture
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../adding-new-languages/" title="Support for New Languages" class="md-nav__link">
      Support for New Languages
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../../about/" title="About" class="md-nav__link">
      About
    </a>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#chaincode-as-server-setup" class="md-nav__link">
    Chaincode as Server Setup
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/IBM/hlf-internals/edit/master/docs/shim-architecture/execution-patterns.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71,7.04C21.1,6.65 21.1,6 20.71,5.63L18.37,3.29C18,2.9 17.35,2.9 16.96,3.29L15.12,5.12L18.87,8.87M3,17.25V21H6.75L17.81,9.93L14.06,6.18L3,17.25Z" /></svg>
                  </a>
                
                
                  
                
                
                <h1 id="chaincode-execution-patterns">Chaincode Execution Patterns</h1>
<p>The fabric shim supports two execution modalities, which control the connection behaviour of the chaincode with the peer:</p>
<ul>
<li><strong>Chaincode as Client</strong>: this is the default modality and the only one used in Hyperledger Fabric v1.4. This is the execution mode that has been discussed in this documentation and features the chaincode process being a client that initiates the connection to the peer.</li>
<li><strong>Chaincode as Server</strong>: this modality, not in use yet, is a preview of a future capability and features the chaincode running as a standalone server accepting connection from the peers.</li>
</ul>
<p>Even though the <strong>Chaincode as Server</strong> is not currently used it is already available in the implementation of the <a href="https://github.com/hyperledger/fabric-chaincode-go">fabric-chaincode-go</a> shim. Besides the differences in the initial setup of the process, this modality will eventually invoke the <code>chatWithPeer(string, ClientStream, Chaincode)</code> function as happens for the <strong>Chaincode as Client</strong> execution modality, that is driven by the shim.</p>
<p>In this section we will only focus in the initial setup differences. More details about this execution modality can be found in the <a href="https://hyperledger-fabric.readthedocs.io/en/latest/cc_service.html">Hyperledger Fabric Documentation</a>.</p>
<h2 id="chaincode-as-server-setup">Chaincode as Server Setup</h2>
<p>Starting from v2.0 Hyperledger Fabric supports chaincode deployment outside of Fabric, thus enabling users to manage a chaincode runtime independently from the peer.</p>
<p>This capability becomes particularly useful in cloud deployments such as Kubernetes, where the chaicode can be managed as a service with an independent life-cycle  from the fabric network. In this scenario it is not necessary to build and launch the chaincode for every peer.</p>
<p>To support the chaincode as an external service, it is necessary:</p>
<ul>
<li>configure the peer with an external builder and launcher; and</li>
<li>initialise and run the chaincode shim as a server process.</li>
</ul>
<p>The implementation of this modality for the chaincode shim, can be found in the following files:</p>
<ul>
<li><a href="https://github.com/hyperledger/fabric-chaincode-go/blob/master/shim/chaincodeserver.go">shim/chaincodeserver.go</a>: implementation of the protobuf service that exposes  the Chaincode interface as GRPC service; and</li>
<li><a href="https://github.com/hyperledger/fabric-chaincode-go/blob/master/shim/internal/server.go">shim/internal/server.go</a>: implementation of a simple GRPC server that is used to register the <code>ChaincodeServer</code> service, accept connections from the peers, and relay the control to the configured <code>Chaincode</code>.</li>
</ul>
<p>To initialise the chaincode process in this modality, we wont be using the <code>shim.Start(Chaincode)</code> method as a driver for the chaincode process but we will be calling the <code>ChaincodeServer.Start(Chaincode)</code> method on a newly created <code>ChaincodeServer</code> struct.</p>
<div class="codehilite"><pre><span></span><code><span class="c1">// repository: https://github.com/hyperledger/fabric-protos</span>
<span class="c1">// file: peer/chaincode_shim.proto</span>

<span class="kd">service</span> <span class="n">Chaincode</span> <span class="p">{</span>

  <span class="k">rpc</span> <span class="n">Connect</span><span class="p">(</span><span class="n">stream</span> <span class="n">ChincodeMessage</span><span class="p">)</span> <span class="k">returns</span> <span class="p">(</span><span class="n">stream</span> <span class="n">ChaincodeMessage</span><span class="p">)</span>
<span class="p">}</span>
</code></pre></div>


<p>The listing above shows the definition of the interface that exposes the Chaincode as a GRPC service. The behaviour is very similar to the <strong>Chaincode as Client</strong> execution pattern but simply reversed. The interface only declares one method that opens a bidirectional stream with the peer. The implementation of the service bindings for Go can be found in the <a href="https://github.com/hyperledger/fabric-protos-go">fabric-protos-go</a> repository.</p>
<p>The listing below provides a summarised view of the <code>ChaincodeServer</code> implementation with a focus on the key method that setup the chaincode process as a server.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">type</span> <span class="nx">ChaincodeServer</span> <span class="kd">struct</span> <span class="p">{</span>
   <span class="nx">CCID</span> <span class="kt">string</span>
   <span class="nx">Address</span> <span class="kt">string</span>
   <span class="nx">CC</span> <span class="nx">Chaincode</span>
   <span class="nx">TLSPRops</span> <span class="nx">TLSProperties</span>
   <span class="nx">KaOpts</span> <span class="o">*</span><span class="nx">keepalive</span><span class="p">.</span><span class="nx">ServerParameters</span>
<span class="p">}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">cs</span> <span class="o">*</span><span class="nx">ChaincodeServer</span><span class="p">)</span> <span class="nx">Connect</span><span class="p">(</span><span class="nx">stream</span> <span class="nx">pb</span><span class="p">.</span><span class="nx">Chaincode_ConnectServer</span><span class="p">)</span> <span class="kt">error</span> <span class="p">{</span>
   <span class="k">return</span> <span class="nx">chatWithPeer</span><span class="p">(</span><span class="nx">cs</span><span class="p">.</span><span class="nx">CCID</span><span class="p">,</span> <span class="nx">stream</span><span class="p">,</span> <span class="nx">cs</span><span class="p">.</span><span class="nx">CC</span><span class="p">)</span>
<span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">cs</span> <span class="o">*</span><span class="nx">ChaincodeServer</span><span class="p">)</span> <span class="nx">Start</span><span class="p">()</span> <span class="kt">error</span> <span class="p">{</span>

  <span class="o">...</span>
  <span class="nx">server</span><span class="p">,</span> <span class="nx">err</span> <span class="o">:=</span> <span class="nx">internal</span><span class="p">.</span><span class="nx">newServer</span><span class="p">(</span><span class="nx">cs</span><span class="p">.</span><span class="nx">Address</span><span class="p">,</span> <span class="nx">tlsCfg</span><span class="p">,</span> <span class="nx">cs</span><span class="p">.</span><span class="nx">KaOpts</span><span class="p">)</span>
  <span class="o">...</span>
  <span class="nx">pb</span><span class="p">.</span><span class="nx">RegisterChaincodeServer</span><span class="p">(</span><span class="nx">server</span><span class="p">.</span><span class="nx">Server</span><span class="p">,</span> <span class="nx">cs</span><span class="p">)</span>

  <span class="k">return</span> <span class="nx">server</span><span class="p">.</span><span class="nx">Start</span><span class="p">()</span>
<span class="p">}</span>
</code></pre></div>


<p>As shown in the listing the method that is bound to the <code>Connect</code> function exposed by the GRPC service simply calls <code>chatWithPeer(string, ClientStream, Chaincode)</code> by passing the bidirectional stream just established for the incoming connection and the <code>Chaincode</code> implementation that is configured with the server. Once the method is invoked, the control for that connection is passed to message receiving loop that has been previously discussed.</p>
<p>Below is a simple example of how to initialise the process as a server and configure it with a <code>Chaincode</code> implementation.</p>
<div class="codehilite"><pre><span></span><code><span class="kd">type</span> <span class="nx">SimpleChaincode</span> <span class="kd">struct</span> <span class="p">{}</span>

<span class="kd">func</span> <span class="p">(</span><span class="nx">ssc</span> <span class="o">*</span><span class="nx">SimpleChaincode</span><span class="p">)</span> <span class="nx">Init</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeInterface</span><span class="p">)</span> <span class="o">*</span><span class="nx">pb</span><span class="p">.</span><span class="nx">Response</span> <span class="p">{</span> <span class="o">...</span><span class="p">.</span> <span class="p">}</span>
<span class="kd">func</span> <span class="p">(</span><span class="nx">ssc</span> <span class="o">*</span><span class="nx">SimpleChaincode</span><span class="p">)</span> <span class="nx">Invoke</span><span class="p">(</span><span class="nx">stub</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeInterface</span><span class="p">)</span> <span class="o">*</span><span class="nx">pb</span><span class="p">.</span><span class="nx">Response</span> <span class="p">{</span> <span class="o">...</span><span class="p">.</span> <span class="p">}</span>


<span class="kd">func</span> <span class="nx">main</span><span class="p">()</span> <span class="p">{</span>

   <span class="nx">ccid</span> <span class="o">:=</span> <span class="s">&quot;simplechaincode:1.0&quot;</span>
   <span class="nx">server</span> <span class="o">:=</span> <span class="o">&amp;</span><span class="nx">shim</span><span class="p">.</span><span class="nx">ChaincodeServer</span><span class="p">{</span> <span class="nx">CCID</span><span class="p">:</span> <span class="nx">ccid</span><span class="p">,</span>
                                    <span class="nx">Address</span><span class="p">:</span> <span class="s">&quot;localhost:9999&quot;</span><span class="p">,</span>
                                    <span class="nx">CC</span><span class="p">:</span> <span class="nb">new</span><span class="p">(</span><span class="nx">SimpleChaincode</span><span class="p">),</span>
                                    <span class="nx">TLSProp</span><span class="p">:</span> <span class="nx">shim</span><span class="p">.</span><span class="nx">TLSProperties</span><span class="p">{</span> <span class="nx">Disabled</span><span class="p">:</span> <span class="kc">true</span> <span class="p">},</span> <span class="p">}</span>

   <span class="nx">err</span> <span class="o">:=</span> <span class="nx">server</span><span class="p">.</span><span class="nx">Start</span><span class="p">()</span>
   <span class="k">if</span> <span class="nx">err</span> <span class="o">!=</span> <span class="kc">nil</span> <span class="p">{</span>
       <span class="nx">fmt</span><span class="p">.</span><span class="nx">Printf</span><span class="p">(</span><span class="s">&quot;Error starting the simple chaincode server: %s&quot;</span><span class="p">,</span> <span class="nx">err</span><span class="p">)</span>
   <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>


<p>For the configuration of the connection properties and the security see the section <a href="../security/">Securing the Chaincode Process</a>.</p>
                
                  
                    

<hr>
<div class="md-source-date">
  <small>
    
      Last update: April 15, 2020 13:57:25
    
  </small>
</div>
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../interaction-flow/chaincode-events/" title="Chaincode Events" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20,11V13H8L13.5,18.5L12.08,19.92L4.16,12L12.08,4.08L13.5,5.5L8,11H20Z" /></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Chaincode Events
              </div>
            </div>
          </a>
        
        
          <a href="../security/" title="Securing the Chaincode Process" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Securing the Chaincode Process
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4,11V13H16L10.5,18.5L11.92,19.92L19.84,12L11.92,4.08L10.5,5.5L16,11H4Z" /></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.36cbf620.min.js"></script>
      <script src="../../assets/javascripts/bundle.00c583dd.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.7f7c8775.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>